# Note: build this package with --force flag
# Note: keep insync with mesa pkg
#
# Maintainer: Roland Singer <roland@manajro.org>
# Co-Maintainer: Clittle <philm@manjaro.org>

pkgname=('libgl')
pkgver=8.0.4
pkgrel=2
arch=('i686' 'x86_64')
depends=('mhwd' 'libdrm>=2.4.31' 'libxxf86vm>=1.1.1' 'libxdamage>=1.1.3' 'expat>=2.0.1' 'libglapi' 'gcc-libs')
pkgdesc="Mesa 3-D graphics library and DRI software rasterizer"
#replaces=('unichrome-dri' 'mach64-dri' 'mga-dri' 'r128-dri' 'savage-dri' 'sis-dri' 'tdfx-dri')
install=libgl.install
url="http://mesa3d.sourceforge.net"
license=('custom')
source=(http://mirror.us.leaseweb.net/archlinux/extra/os/$CARCH/$pkgname-$pkgver-$pkgrel-$CARCH.pkg.tar.xz)
if [ "$CARCH" = "i686" ]; then
   sha256sums=('e0720bb5432a8d411ce5e6849bab4522509e0f20f82f6241f69c9bd9e62dbb34')
else
   sha256sums=('5b8a0e5c4ec5fb7b1e05fb41fcec2a6f223806372e54d6e08bd8578a49e79484')
fi

package() {
  cp -rPf usr ${pkgdir}
  mv "${pkgdir}/usr/lib/libGL.so.1.2" "${pkgdir}/usr/lib/libGL.so.mesa"
  rm "${pkgdir}/usr/lib/libGL.so.1"
  rm "${pkgdir}/usr/lib/libGL.so"
  rm "${pkgdir}/usr/lib/xorg/modules/extensions/libglx.so"
}
