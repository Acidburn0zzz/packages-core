# Maintainer: Clittle <philm@manjaro.org>
# Maintainer: Roland Singer <roland@manjaro.org>

pkgname=mhwd-nvidia-legacy
pkgver=304.88
pkgrel=1
url="http://www.nvidia.com/"
license=('custom')


if [ "$CARCH" = "i686" ]; then
    _arch='x86'
    _pkg="NVIDIA-Linux-${_arch}-${pkgver}"
    source=("http://us.download.nvidia.com/XFree86/Linux-${_arch}/${pkgver}/${_pkg}.run")
    sha256sums=('71e10294f073e31a387da4282b95cdde5fbfc996cb1c564f290eb0df1289b7cb')
elif [ "$CARCH" = "x86_64" ]; then
    _arch='x86_64'
    _pkg="NVIDIA-Linux-${_arch}-${pkgver}-no-compat32"
    source=("http://us.download.nvidia.com/XFree86/Linux-${_arch}/${pkgver}/${_pkg}.run")
    sha256sums=('4372cc7b82ed3b5fde41e9bf0e0c1899cfbc3e79d4ed422c499b6d41b557d2c9')
fi


build() {
    cd "${srcdir}"
    sh "${_pkg}.run" --extract-only
}


package() {
    pkgdesc="MHWD module-ids for nvidia $pkgver"
    arch=('any')

    install -d -m755 "${pkgdir}/var/lib/mhwd/ids/pci/"

    # Generate mhwd database
    sh -e ${srcdir}/../mhwd-nvidia \
    ${srcdir}/${_pkg}/README.txt \
    ${srcdir}/${_pkg}/kernel/nv-kernel.o \
    > ${pkgdir}/var/lib/mhwd/ids/pci/nvidia-legacy.ids
}
